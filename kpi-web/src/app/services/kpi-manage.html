<div class="flex h-screen bg-gray-100 font-sans overflow-hidden">
  <!-- Sidebar -->
  <aside class="bg-gradient-to-b from-green-800 to-green-600 text-white flex flex-col shadow-xl z-20 transition-all duration-700 ease-in-out overflow-hidden whitespace-nowrap" [ngClass]="isSidebarOpen ? 'w-64 opacity-100' : 'w-0 opacity-0'">
    <div class="h-16 flex items-center px-6 border-b border-green-500/30 bg-green-900/20">
      <span class="text-lg font-bold tracking-wide">KPI Health Center</span>
      <button (click)="toggleSidebar()" class="ml-auto text-white hover:text-green-200 focus:outline-none">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
      <a routerLink="/charts" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer"><i class="fas fa-chart-bar text-xl mr-3"></i> รายงานสถิติ</a>
      <a routerLink="/dashboard" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-th-large text-xl mr-3"></i>
        <span class="truncate flex justify-between items-center w-full">
          ภาพรวมตัวชี้วัด
          <span *ngIf="(isAdmin || isSuperAdmin) && pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/users" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer text-sm">
        <i class="fas fa-users-cog text-lg mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          จัดการผู้ใช้งาน
          <span *ngIf="pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/kpi-manage" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer text-sm">
        <i class="fas fa-tasks text-lg mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          จัดการตัวชี้วัด
          <span *ngIf="pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/audit-logs" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer text-sm">
        <i class="fas fa-history text-lg mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          ประวัติการใช้งาน
          <span *ngIf="pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/kpi-setup" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer text-sm">
        <i class="fas fa-plus-circle text-lg mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          +KPI ปีงบประมาณใหม่
          <span *ngIf="pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <!-- เพิ่มปุ่มตั้งค่าระบบ (Admin/Super Admin) -->
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/settings" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer text-sm">
        <i class="fas fa-sliders-h text-lg mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          ตั้งค่าระบบ
          <span *ngIf="pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
    </nav>
    <div class="p-4 border-t border-green-500/30">
      <button (click)="logout()" class="flex items-center w-full px-4 py-3 text-green-100 hover:bg-red-500 hover:text-white rounded-xl transition-colors cursor-pointer"><i class="fas fa-sign-out-alt text-xl mr-3"></i> ออกจากระบบ</button>
      <div class="mt-4 text-center text-xs text-green-200/60 font-mono">{{ systemVersion }}</div>
    </div>
  </aside>

  <div class="flex-1 flex flex-col overflow-hidden">
    <header class="h-16 bg-gradient-to-r from-green-800 to-green-600 shadow-md flex items-center justify-between px-6 z-10">
      <div class="flex items-center">
        <button (click)="toggleSidebar()" class="text-white hover:text-green-200 focus:outline-none mr-4" [ngClass]="isSidebarOpen ? 'hidden' : 'block'"><i class="fas fa-bars text-xl"></i></button>
        <h2 class="text-xl font-semibold text-white">จัดการข้อมูลตัวชี้วัด</h2>
      </div>
      <div class="flex items-center">
        <div class="text-right mr-3 hidden sm:block">
          <p class="text-sm font-bold text-white">{{ currentUserDisplay?.firstname }} {{ currentUserDisplay?.lastname }}</p>
          <p class="text-xs text-green-100">{{ currentUserDisplay?.service_unit || currentUserDisplay?.role }}</p>
        </div>
        <div class="h-10 w-10 rounded-full bg-white/20 border-2 border-white/30 flex items-center justify-center text-white font-bold backdrop-blur-sm">{{ currentUserDisplay?.username?.charAt(0).toUpperCase() }}</div>
      </div>
    </header>

    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6">
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <!-- Tabs -->
        <div class="flex border-b border-gray-200">
          <button (click)="switchTab('indicators')" [class]="activeTab === 'indicators' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">ตัวชี้วัด (KPIs)</button>
          <button (click)="switchTab('main-indicators')" [class]="activeTab === 'main-indicators' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">หมวดหมู่หลัก</button>
          <button (click)="switchTab('strategies')" [class]="activeTab === 'strategies' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">ยุทธศาสตร์</button>
          <button (click)="switchTab('departments')" [class]="activeTab === 'departments' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">หน่วยงาน</button>
        </div>

        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <div class="relative w-64" *ngIf="activeTab === 'indicators'">
              <input type="text" [(ngModel)]="searchTerm" (input)="applyFilter()" placeholder="ค้นหา..." class="w-full pl-4 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-sm">
            </div>
            <div *ngIf="activeTab !== 'indicators'"></div> <!-- Spacer -->
            <button (click)="openModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-md transition-colors text-sm font-bold"><i class="fas fa-plus mr-2"></i> เพิ่มข้อมูล</button>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider">ID</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'indicators'">ชื่อตัวชี้วัด</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'indicators'">หมวดหมู่หลัก</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'indicators'">หน่วยงาน</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'main-indicators'">ชื่อหมวดหมู่หลัก</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'strategies'">ชื่อยุทธศาสตร์</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'departments'">รหัส</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider" *ngIf="activeTab === 'departments'">ชื่อหน่วยงาน</th>
                  <th class="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider text-right">จัดการ</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100">
                <tr *ngFor="let item of (activeTab === 'indicators' ? filteredIndicators : (activeTab === 'main-indicators' ? mainIndicators : (activeTab === 'strategies' ? strategies : departments)))" class="hover:bg-gray-50">
                  <td class="px-6 py-4 text-gray-600">{{ item.id }}</td>
                  
                  <ng-container *ngIf="activeTab === 'indicators'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.report_name }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ item.main_indicator_name }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ item.dept_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'main-indicators'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.indicator_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'strategies'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.yut_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'departments'">
                    <td class="px-6 py-4 text-gray-600">{{ item.dept_code }}</td>
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.dept_name }}</td>
                  </ng-container>

                  <td class="px-6 py-4 text-right space-x-2">
                    <button (click)="openModal(item)" class="text-yellow-500 hover:text-yellow-600"><i class="fas fa-edit"></i></button>
                    <button (click)="deleteItem(item.id)" class="text-red-500 hover:text-red-600"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 transform transition-all scale-100 overflow-y-auto max-h-[90vh]">
      <h3 class="text-xl font-bold text-gray-800 mb-4">{{ isEditMode ? 'แก้ไขข้อมูล' : 'เพิ่มข้อมูลใหม่' }}</h3>
      
      <div class="space-y-4">
        <!-- Fields for Indicators -->
        <ng-container *ngIf="activeTab === 'indicators'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อตัวชี้วัด</label><input type="text" [(ngModel)]="currentItem.report_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">รหัสตัวชี้วัด</label><input type="text" [(ngModel)]="currentItem.report_code" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">หมวดหมู่หลัก</label>
            <select [(ngModel)]="currentItem.main_indicator_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500">
              <option *ngFor="let m of mainIndicators" [value]="m.id">{{ m.indicator_name }}</option>
            </select>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">หน่วยงาน</label>
            <select [(ngModel)]="currentItem.dept_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500">
              <option *ngFor="let d of departments" [value]="d.id">{{ d.dept_name }}</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-sm font-medium text-gray-700 mb-1">เป้าหมาย</label><input type="text" [(ngModel)]="currentItem.target_percentage" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
            <div><label class="block text-sm font-medium text-gray-700 mb-1">น้ำหนัก</label><input type="text" [(ngModel)]="currentItem.weight" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
          </div>
        </ng-container>

        <!-- Fields for Main Indicators -->
        <ng-container *ngIf="activeTab === 'main-indicators'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อหมวดหมู่หลัก</label><input type="text" [(ngModel)]="currentItem.indicator_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ยุทธศาสตร์</label>
            <select [(ngModel)]="currentItem.yut_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500">
              <option *ngFor="let s of strategies" [value]="s.id">{{ s.yut_name }}</option>
            </select>
          </div>
        </ng-container>

        <!-- Fields for Strategies -->
        <ng-container *ngIf="activeTab === 'strategies'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อยุทธศาสตร์</label><input type="text" [(ngModel)]="currentItem.yut_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
        </ng-container>

        <!-- Fields for Departments -->
        <ng-container *ngIf="activeTab === 'departments'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">รหัสหน่วยงาน</label><input type="text" [(ngModel)]="currentItem.dept_code" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อหน่วยงาน</label><input type="text" [(ngModel)]="currentItem.dept_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500"></div>
        </ng-container>
      </div>

      <div class="mt-6 flex justify-end gap-3">
        <button (click)="closeModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-bold">ยกเลิก</button>
        <button (click)="saveItem()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold shadow-md">บันทึก</button>
      </div>
    </div>
  </div>
</div>
```

### 4. เพิ่ม Route (`app.routes.ts`)

```diff