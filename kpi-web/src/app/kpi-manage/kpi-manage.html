<div class="flex h-screen bg-gray-100 font-sans overflow-hidden">
  <!-- Sidebar -->
  <aside class="bg-gradient-to-b from-green-800 to-green-600 text-white flex flex-col shadow-xl z-20 transition-all duration-700 ease-in-out overflow-hidden whitespace-nowrap" [ngClass]="isSidebarOpen ? 'w-64 opacity-100' : 'w-0 opacity-0'">
    <div class="h-16 flex items-center px-6 border-b border-green-500/30 bg-green-900/20">
      <i class="fas fa-heartbeat text-2xl mr-3"></i>
      <span class="text-lg font-bold tracking-wide">Korat Health KPI</span>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
      <a routerLink="/charts" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer"><i class="fas fa-chart-bar text-xl mr-3"></i> รายงานสถิติ</a>
      <a routerLink="/reports" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-file-alt text-xl mr-3 min-w-[24px]"></i>
        <span class="truncate">รายงานสรุปผล</span>
      </a>
      <a routerLink="/notifications" class="flex items-center px-4 py-2.5 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-bell text-lg mr-3 min-w-[24px]"></i>
        <span class="truncate flex justify-between items-center w-full">
          แจ้งเตือน
          <span *ngIf="unreadNotifCount > 0" class="flex h-5 min-w-[20px] px-1 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white animate-pulse">{{ unreadNotifCount }}</span>
        </span>
      </a>
      <a routerLink="/dashboard" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-th-large text-xl mr-3"></i>
        <span class="truncate flex justify-between items-center w-full">
          ภาพรวมตัวชี้วัด
          <span *ngIf="(isAdmin || isSuperAdmin) && pendingKpiCount > 0" class="flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ml-2 animate-pulse shadow-lg">
            {{ pendingKpiCount }}
          </span>
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/users" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-users-cog text-xl mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          จัดการผู้ใช้งาน
          
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/kpi-manage" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-tasks text-xl mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          จัดการตัวชี้วัด
          
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/audit-logs" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-history text-xl mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          ประวัติการใช้งาน
          
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/kpi-setup" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-plus-circle text-xl mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          +KPI ปีงบประมาณใหม่
          
        </span>
      </a>
      <a *ngIf="isAdmin || isSuperAdmin" routerLink="/settings" class="flex items-center px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer">
        <i class="fas fa-sliders-h text-xl mr-3 min-w-[24px]"></i> 
        <span class="truncate flex justify-between items-center w-full">
          ตั้งค่าระบบ
          
        </span>
      </a>
    </nav>
    <div class="p-4 border-t border-green-500/30">
      <button (click)="openChangePasswordModal()" class="flex items-center w-full px-4 py-3 text-green-100 hover:bg-white/10 hover:text-white rounded-xl transition-colors cursor-pointer mb-1">
        <i class="fas fa-key text-xl mr-3 min-w-[24px]"></i>
        <span class="truncate">เปลี่ยนรหัสผ่าน</span>
      </button>
      <button (click)="logout()" class="flex items-center w-full px-4 py-3 text-green-100 hover:bg-red-500 hover:text-white rounded-xl transition-colors cursor-pointer"><i class="fas fa-sign-out-alt text-xl mr-3"></i> ออกจากระบบ</button>
      <div class="mt-4 text-center text-xs text-green-200/60 font-mono">{{ systemVersion }}</div>
    </div>
  </aside>

  <div class="flex-1 flex flex-col overflow-hidden">
    <header class="h-16 bg-gradient-to-r from-green-800 to-green-600 shadow-md flex items-center justify-between px-6 z-10">
      <div class="flex items-center">
        <button (click)="toggleSidebar()" class="text-white hover:text-green-200 focus:outline-none mr-4 lg:hidden" [ngClass]="isSidebarOpen ? 'block' : 'block'">
          <i class="fas fa-bars text-xl"></i>
        </button>
        <button (click)="toggleSidebar()" class="text-white hover:text-green-200 focus:outline-none mr-4 hidden lg:block" [ngClass]="isSidebarOpen ? 'hidden' : 'block'">
          <i class="fas fa-bars text-xl"></i>
        </button>
        <h2 class="text-xl font-semibold text-white">จัดการข้อมูลตัวชี้วัด</h2>
        <span *ngIf="(isAdmin || isSuperAdmin) && pendingKpiCount > 0" class="flex h-6 min-w-[24px] px-1.5 items-center justify-center rounded-full bg-red-500 text-[11px] font-bold text-white ml-2 animate-pulse shadow-lg">
          {{ pendingKpiCount }}
        </span>
      </div>
      <div class="flex items-center">
        <!-- Bell Icon + Notification Dropdown -->
        <div class="relative mr-4">
          <button (click)="toggleNotifDropdown()" class="relative text-white hover:text-green-200 focus:outline-none">
            <i class="fas fa-bell text-xl"></i>
            <span *ngIf="unreadNotifCount > 0" class="absolute -top-1 -right-1 flex h-4 min-w-[16px] px-0.5 items-center justify-center rounded-full bg-red-500 text-[9px] font-bold text-white animate-pulse">
              {{ unreadNotifCount > 99 ? '99+' : unreadNotifCount }}
            </span>
          </button>
          <div *ngIf="showNotifDropdown" class="absolute right-0 top-10 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 max-h-96 overflow-hidden">
            <div class="flex items-center justify-between px-4 py-3 border-b bg-gray-50 rounded-t-xl">
              <span class="font-bold text-gray-700 text-sm">การแจ้งเตือน</span>
              <button *ngIf="unreadNotifCount > 0" (click)="markAllNotifsRead()" class="text-xs text-green-600 hover:text-green-800 font-medium">อ่านทั้งหมด</button>
            </div>
            <div class="overflow-y-auto max-h-72">
              <div *ngIf="notifications.length === 0" class="p-6 text-center text-gray-400 text-sm">ไม่มีการแจ้งเตือน</div>
              <div *ngFor="let notif of notifications.slice(0, 10)"
                   (click)="!notif.is_read && markNotifAsRead([notif.id])"
                   class="px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors"
                   [ngClass]="notif.is_read ? 'bg-white' : 'bg-blue-50/50'">
                <div class="flex items-start gap-2">
                  <i class="fas mt-0.5 text-sm" [ngClass]="notif.type === 'approve' ? 'fa-check-circle text-green-500' : notif.type === 'reject' ? 'fa-times-circle text-red-500' : 'fa-info-circle text-blue-500'"></i>
                  <div class="flex-1 min-w-0">
                    <p class="text-xs font-semibold text-gray-800 truncate">{{ notif.title }}</p>
                    <p class="text-[11px] text-gray-500 line-clamp-2">{{ notif.message }}</p>
                    <p class="text-[10px] text-gray-400 mt-1">{{ notif.created_at | date:'dd/MM/yyyy HH:mm' }}</p>
                  </div>
                  <span *ngIf="!notif.is_read" class="h-2 w-2 rounded-full bg-blue-500 mt-1 shrink-0"></span>
                </div>
              </div>
            </div>
            <a routerLink="/notifications" (click)="showNotifDropdown = false" class="block text-center py-2.5 text-xs text-green-600 hover:text-green-800 font-medium border-t bg-gray-50 rounded-b-xl hover:bg-gray-100 transition-colors">
              ดูทั้งหมด →
            </a>
          </div>
        </div>
        <div class="text-right mr-3 hidden sm:block">
          <p class="text-sm font-bold text-white">({{ currentUserDisplay?.role }}) {{ currentUserDisplay?.firstname }} {{ currentUserDisplay?.lastname }}</p>
          <p class="text-xs text-green-100">{{ currentUserDisplay?.service_unit || currentUserDisplay?.role }}</p>
        </div>
        <div class="h-10 w-10 rounded-full bg-white/20 border-2 border-white/30 flex items-center justify-center text-white font-bold backdrop-blur-sm">{{ currentUserDisplay?.username?.charAt(0).toUpperCase() }}</div>
      </div>
    </header>

    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 p-6">
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <!-- Tabs -->
        <div class="flex border-b border-gray-200">
          <button (click)="switchTab('indicators')" [class]="activeTab === 'indicators' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">ตัวชี้วัด (KPIs)</button>
          <button (click)="switchTab('main-indicators')" [class]="activeTab === 'main-indicators' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">หมวดหมู่หลัก</button>
          <button (click)="switchTab('strategies')" [class]="activeTab === 'strategies' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">ยุทธศาสตร์</button>
          <button (click)="switchTab('departments')" [class]="activeTab === 'departments' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'" class="flex-1 py-4 px-6 text-center border-b-2 font-medium text-sm focus:outline-none">หน่วยงาน</button>
        </div>

        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <div class="relative w-full md:w-1/3 mt-2">
              <label class="absolute -top-2 left-3 bg-white px-1 text-xs font-bold text-gray-500 uppercase z-10">ค้นหา</label>
              <input type="text" [(ngModel)]="searchTerm" (input)="applyFilter()" 
                     [placeholder]="activeTab === 'indicators' ? 'ชื่อ / รหัสตัวชี้วัด...' : activeTab === 'main-indicators' ? 'ชื่อหมวดหมู่หลัก...' : activeTab === 'strategies' ? 'ชื่อยุทธศาสตร์...' : 'ชื่อ / รหัสหน่วยงาน...'"
                     class="w-full pl-4 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-sm hover:border-green-400 transition-colors">
            </div>
            <button (click)="openModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-md transition-colors text-sm font-bold"><i class="fas fa-plus mr-2"></i> เพิ่มข้อมูล</button>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
              <thead class="bg-gradient-to-r from-green-700 to-green-600 text-white">
                <tr>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider rounded-tl-xl">ID</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'indicators'">ชื่อตัวชี้วัด</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'indicators'">หมวดหมู่หลัก</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'indicators'">หน่วยงาน</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'main-indicators'">ชื่อหมวดหมู่หลัก</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'strategies'">ชื่อยุทธศาสตร์</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'departments'">รหัส</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider" *ngIf="activeTab === 'departments'">ชื่อหน่วยงาน</th>
                  <th class="px-6 py-3 text-sm font-bold uppercase tracking-wider text-right rounded-tr-xl">จัดการ</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100">
                <tr *ngFor="let item of (activeTab === 'indicators' ? filteredIndicators : (activeTab === 'main-indicators' ? filteredMainIndicators : (activeTab === 'strategies' ? filteredStrategies : filteredDepartments)))" class="hover:bg-gray-50">
                  <td class="px-6 py-4 text-gray-600">{{ item.id }}</td>
                  
                  <ng-container *ngIf="activeTab === 'indicators'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.kpi_indicators_name }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ item.main_indicator_name }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ item.dept_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'main-indicators'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.main_indicator_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'strategies'">
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.yut_name }}</td>
                  </ng-container>

                  <ng-container *ngIf="activeTab === 'departments'">
                    <td class="px-6 py-4 text-gray-600">{{ item.dept_code }}</td>
                    <td class="px-6 py-4 font-medium text-gray-900">{{ item.dept_name }}</td>
                  </ng-container>

                  <td class="px-6 py-4 text-right space-x-2">
                    <button (click)="openModal(item)" class="text-yellow-500 hover:text-yellow-600"><i class="fas fa-edit"></i></button>
                    <button (click)="deleteItem(item.id)" class="text-red-500 hover:text-red-600"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 transform transition-all scale-100 overflow-y-auto max-h-[90vh]">
      <h3 class="text-xl font-bold text-gray-800 mb-4">{{ isEditMode ? 'แก้ไขข้อมูล' : 'เพิ่มข้อมูลใหม่' }}</h3>
      
      <div class="space-y-4">
        <!-- Fields for Indicators -->
        <ng-container *ngIf="activeTab === 'indicators'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อตัวชี้วัด</label><input type="text" [(ngModel)]="currentItem.kpi_indicators_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">รหัสตัวชี้วัด</label><input type="text" [(ngModel)]="currentItem.kpi_indicators_code" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">หมวดหมู่หลัก</label>
            <select [(ngModel)]="currentItem.main_indicator_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors">
              <option *ngFor="let m of mainIndicators" [value]="m.id">{{ m.main_indicator_name }}</option>
            </select>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">หน่วยงาน</label>
            <select [(ngModel)]="currentItem.dept_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors">
              <option *ngFor="let d of departments" [value]="d.id">{{ d.dept_name }}</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-sm font-medium text-gray-700 mb-1">เป้าหมาย</label><input type="text" [(ngModel)]="currentItem.target_percentage" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
            <div><label class="block text-sm font-medium text-gray-700 mb-1">น้ำหนัก</label><input type="text" [(ngModel)]="currentItem.weight" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
          </div>
        </ng-container>

        <!-- Fields for Main Indicators -->
        <ng-container *ngIf="activeTab === 'main-indicators'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อหมวดหมู่หลัก</label><input type="text" [(ngModel)]="currentItem.main_indicator_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ยุทธศาสตร์</label>
            <select [(ngModel)]="currentItem.yut_id" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors">
              <option *ngFor="let s of strategies" [value]="s.id">{{ s.yut_name }}</option>
            </select>
          </div>
        </ng-container>

        <!-- Fields for Strategies -->
        <ng-container *ngIf="activeTab === 'strategies'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อยุทธศาสตร์</label><input type="text" [(ngModel)]="currentItem.yut_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
        </ng-container>

        <!-- Fields for Departments -->
        <ng-container *ngIf="activeTab === 'departments'">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">รหัสหน่วยงาน</label><input type="text" [(ngModel)]="currentItem.dept_code" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">ชื่อหน่วยงาน</label><input type="text" [(ngModel)]="currentItem.dept_name" class="w-full px-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-green-500 hover:border-green-400 transition-colors"></div>
        </ng-container>
      </div>

      <div class="mt-6 flex justify-end gap-3">
        <button (click)="closeModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-bold">ยกเลิก</button>
        <button (click)="saveItem()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold shadow-md">บันทึก</button>
      </div>
    </div>
  </div>

  <!-- Modal เปลี่ยนรหัสผ่าน -->
  <div *ngIf="showChangePasswordModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-4 sm:p-6 transform transition-all scale-100">
      <div class="flex items-center mb-4 sm:mb-5">
        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
          <i class="fas fa-key text-green-600"></i>
        </div>
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">เปลี่ยนรหัสผ่าน</h3>
      </div>
      <div class="space-y-3 sm:space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">รหัสผ่านปัจจุบัน</label>
          <div class="relative">
            <input [type]="showCurrentPw ? 'text' : 'password'" [(ngModel)]="changePasswordForm.currentPassword" placeholder="กรอกรหัสผ่านปัจจุบัน"
              class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none hover:border-green-400 transition-colors">
            <button type="button" (click)="showCurrentPw = !showCurrentPw" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none">
              <i [class]="showCurrentPw ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">รหัสผ่านใหม่</label>
          <div class="relative">
            <input [type]="showNewPw ? 'text' : 'password'" [(ngModel)]="changePasswordForm.newPassword" placeholder="อย่างน้อย 6 ตัวอักษร"
              class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none hover:border-green-400 transition-colors">
            <button type="button" (click)="showNewPw = !showNewPw" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none">
              <i [class]="showNewPw ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ยืนยันรหัสผ่านใหม่</label>
          <div class="relative">
            <input [type]="showConfirmPw ? 'text' : 'password'" [(ngModel)]="changePasswordForm.confirmPassword" placeholder="กรอกรหัสผ่านใหม่อีกครั้ง"
              class="w-full px-3 sm:px-4 py-2.5 sm:py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none hover:border-green-400 transition-colors"
              [ngClass]="changePasswordForm.confirmPassword && changePasswordForm.newPassword !== changePasswordForm.confirmPassword ? 'border-red-400 focus:ring-red-400' : ''">
            <button type="button" (click)="showConfirmPw = !showConfirmPw" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none">
              <i [class]="showConfirmPw ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
          <p *ngIf="changePasswordForm.confirmPassword && changePasswordForm.newPassword !== changePasswordForm.confirmPassword" class="text-xs text-red-500 mt-1">รหัสผ่านไม่ตรงกัน</p>
        </div>
      </div>
      <div class="mt-4 sm:mt-6 flex flex-col sm:flex-row justify-end gap-2 sm:gap-3">
        <button (click)="closeChangePasswordModal()" class="w-full sm:w-auto px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-bold transition-colors">ยกเลิก</button>
        <button (click)="saveNewPassword()" class="w-full sm:w-auto px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold shadow-md transition-colors">
          <i class="fas fa-save mr-2"></i>บันทึก
        </button>
      </div>
    </div>
  </div>

  <!-- Overlay ปิด Notification Dropdown -->
  <div *ngIf="showNotifDropdown" class="fixed inset-0 z-40" (click)="showNotifDropdown = false"></div>
</div>